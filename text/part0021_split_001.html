<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>未知</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">03</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">12</span>
</b>
</i>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">lb</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">eb</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">0b</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">13</span>
</b>
</i>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">Id</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">8d</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">76</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">00</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">14</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">20</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">83</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">cO</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">05</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">15</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">23</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">eb</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">03</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">16</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">25</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">83</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">cO</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">06</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">17</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">28</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">89</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">ec</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">18</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">2a</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">5d</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">)9</span>
</b>
</i>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">2b</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">c3</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">push</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">mov</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">mov</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">le&lt;</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">cm]</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">ja</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">in(</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">jm]</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">ad(</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<span class="calibre4">im</span>
</i>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">le&lt;</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">adc</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">/<sub class="calibre24">
<small class="calibre8">
<span class="calibre18">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">0</span>
</b>
</tt>
</span>
</small>
</sub>
 ebp</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">%esp，％ebp</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">0x8(%ebp),%eax</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">Oxffffff9c(%eax),%edx</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">$0x5,%edx</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">25 &lt;relo3+0x25&gt;</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">95 00 00 00 00</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">*0x0(,%edx,4)</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">%eax</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">28 &lt;relo3+0x28&gt;</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">$0x3,%eax</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">28 &lt;relo3+0x28&gt;</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">OxO(°/<sub class="calibre24">
<small class="calibre8">
<span class="calibre18">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">0</span>
</b>
</tt>
</span>
</small>
</sub>
 esi) ,%esi</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">$0x5,%eax</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre2">
<tt class="calibre3">
<span class="calibre4">p d V p t</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre2">
<tt class="calibre3">
<span class="calibre4">m d o o e j amp r</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">28 &lt;relo3+0x28&gt;</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">$0x6,%eax</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">%ebp,%esp</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">%ebp</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">b)可重定位目标文件的.text节</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">This is the jump table for the swi tch statement</span>
</b>
</i>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre2">
<span class="calibre4">0000</span>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">28000000 15000000 25000000 18000000</span>
</b>
</tt>
</span>
 <span class="calibre2">
<i class="calibre15">
<span class="calibre4">4</span>
</i>
</span>
 <span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">words at offsets</span>
</b>
</i>
</span>
 <span class="calibre2">
<i class="calibre15">
<span class="calibre4">0y：0</span>
</i>
</span>
 <span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">.0x4,0x8, and</span>
</b>
</i>
</span>
 <span class="calibre2">
<i class="calibre15">
<span class="calibre4">Oxc</span>
</i>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">0010</span>
</b>
</tt>
</span>
 <span class="calibre2">
<b class="calibre13">
<span class="calibre4">18000000</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">20000000</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">2</span>
</b>
</i>
</tt>
</span>
 <span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">words at offsets Ox.lG and 0x14</span>
</b>
</i>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">c)可重定位目标文件的.rodata节 图</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">7-21</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">练习题</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">7.14</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">的示例代码</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre2">
<b class="calibre13">
<span class="calibre4">77.15</span>
</b>
</span>
 <tt class="calibre3">
<span class="calibre4">完成下面的任务将帮助你更熟悉处理目标文件的各种工具。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在你的系统上</span>
</tt>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">，</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">libc.a和libm.a的版本中包含多少目标文件？</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">gcc-02产生的可执行代码与gcc -02 -g产生的不同吗？</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在你的系统上</span>
</tt>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">，</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">GCC驱动程序使用的是什么共享库？</span>
</tt>
</p>
<span id="filepos0005125067"></span>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre11">
<tt class="calibre3">
<span class="calibre4">练习题答案</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">练习题八1这道练习题的目的是帮助你理解链接器符号和C变量及函数之间的关系。注意C的本地变量 temp没有符号表条目。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">W¥</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">swap.o</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.symtab条目？</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">符号类型</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">在哪个模块中定义</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">T</span>
</b>
</i>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">buf</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">bufpO</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">bufpl</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">swap</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">temp</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">是</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">是</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">是</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">是</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">否</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">extern</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">main.o</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.data</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">global</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">swap. o</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.data</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">global</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">swap.o</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.bss</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">global</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">swap. o</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">• text</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">练习题</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">7.2这是一个简单的练习，检查你对Unix链接器解析定义在一个以上模块中的全局符号时所使用 规则的理解。理解这些规则可以帮助你避免一些讨厌的编程错误。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">链接器选择定义在模块1中的强符号，而不是定义在模块2中的弱符号（规则2):</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">REF (main. 1) ~&gt; DEF (main. 1)</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">REF(main.2) —&gt; DEF(main.l)</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">这是一个错误，因为每个模块都定义了一个强符号main</span>
</tt>
 <tt class="calibre3">
<span class="calibre4">      </span>
</tt>
 <tt class="calibre3">
<span class="calibre4">(规则1)。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">链接器选择定义在模块2中的强符号，而不是定义在模块1中的弱符号（规则2):</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">REF(x.l) —&gt; DEF(x.2)</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">REF(x.2) —&gt; DEF(x.2)</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">练习题</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">7.3在命令行中错误地放置静态库的位置是造成令许多程序员迷惑的链接器错误的常见原因。然 而，一旦你理解了链接器是如何使用静态库来解析引用的，<sup class="calibre7">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">;</span>
</tt>
</small>
</sup>
 它就相当简单易懂了。这个小练习检查了你对 这个概念的理解：</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">gcc p.o libx.a</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">gcc p.o libx.a liby.a</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">gcc p.o libx.a liby.a libx.a</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">练习题</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">7.4这道题涉及的是图7-10中的反汇编列.表。目的是让你练习阅读反汇编列表，并检查你对PC 相对寻址的理解。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">A.第5行被重定位引用的十六进制地址为0x80483bb。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">B•第5行被重定位引用的十六进制值为0x9。记住，反汇编列表给出的引用值是用小端法字节顺序表示的。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">C.这里的关键观察点是无论链接器将.text节定位在哪里，引用和swap函数间的距离总是一样的。 因此，无论链接器将.text节定位在何处，因为引用是一个PC相对地址，所以它的值都将是0x9。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">练习题</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">7.5对大多数程序员而言，C程序实际是如何启动的是一个谜。这些问题检查了你对这个启动过程 的理解。你可以参考图7-14中的C启动代码来回答这些问题：</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">每个程序都需要一个main函数，因为C的启动代码对于每个C程序而言都是相同的，要跳转到一 个叫做main的函数上。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">如果main以return语句终止，那么控制传递回启动程序，该程序通过调用—exit再将控制返 回给操作系统。如果用户省略了 return语句，也会发生相同的情况。如果main是以调用exit终止 的，那么exit将最终通过调用_找1七将控制返回给操作系统。在这三种情况中，最终效果是相同的：当 main完成时，控制会返回给操作系统。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre11">
<b class="calibre13">
<span class="calibre4">|</span>
</b>
</span>
 <span class="calibre11">
<tt class="calibre3">
<span class="calibre4">第</span>
</tt>
</span>
 <span class="calibre11">
<b class="calibre13">
<span class="calibre4">8</span>
</b>
</span>
 <span class="calibre11">
<tt class="calibre3">
<span class="calibre4">章</span>
</tt>
</span>
 <span class="calibre11">
<b class="calibre13">
<span class="calibre4">|</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<span class="calibre4">I Con^uter Systems</span>
</span>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">：</span>
</tt>
</span>
 <span class="calibre12">
<span class="calibre4">A Programmer' s Perspective, 2E</span>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre11">
<tt class="calibre3">
<span class="calibre4">异常控制流</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">从给处理器加电开始，直到断电为止，程序计数器假设一个值的序列</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">以</span>
</i>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">0</span>
</i>
</tt>
</span>
 <tt class="calibre3">
<i class="calibre15">
<span class="calibre4">，</span>
</i>
</tt>
 <tt class="calibre3">
<span class="calibre4">以1，•••，</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">其中，每个q是某个相应的指令厶的地址。每次从到〜i的过渡称为控制转移（control transfer )<sub class="calibre17">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">0</span>
</tt>
</small>
</sub>
 这样的控制转移序列叫做处理器的控制流（flow of control或control flow)。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">最简单的一种控制流是一个“平滑的”序列，其中每个A和人<sub class="calibre17">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">+1</span>
</tt>
</small>
</sub>
 在存储器中都是相邻的。典 型地，这种平滑流的突变，也就是&amp;与厶不相邻，是由诸如跳转、调用和返回这样一些熟悉的 程序指令造成的。这样一些指令都是必要的机制，使得程序能够对由程序变量表示的内部程序状 态中的变化做出反应。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">但是系统也必须能够对系统状态的变化做出反应，这些系统状态不是被内部程序变量捕获 的，而且也不一定要和程序的执行相关。比如，一个硬件定时器定期产生信号，这个事件必须得 到处理。包到达网络适配器后，必须存放在存储器中。程序向磁盘请求数据，然后休眠，直到被 通知数据已就绪。当子进程终止时，创造这些子进程的父进程必须得到通知。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">现代系统通过使控制流发生突变来对这些情况做出反应。一般而言，我们把这些突变称为异 常控制流（Exceptional Control Flow, ECF)。异常控制流发生在计算机系统的各个层次。比如， 在硬件层，硬件检测到的事件会触发控制突然转移到异常处理程序。在操作系统层，内核通过上 下文转换将控制从一个用户进程转移到另一个用户进程。在应用层，一个进程可以发送信号到另 一个进程，而接收者会将控制突然转移到它的一个信号处理程序。一个程序可以通过回避通常的 栈规则，并执行到其他函数中任意位置的非本地跳转来对错误做出反应。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">作为程序员，理解ECF很重要，这有很多原因：</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•理解ECF将帮助你理解重要的系统概念。ECF是操作系统用来实现I/O、进程和虚拟存储 器的基本机制。在能够真正理解这些重要概念之前，你必须理解ECF。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•理解ECF将帮助你理解应用程序是如何与操作系统交互的。应用程序通过使f 一个叫做陷 阱（trap)或者系统调用（system call)的ECF形式，向操作系统请求服务。比如，向磁盘 写数据、从网络读取数据、创建一个新进程，以及终止当前进程，都是通过应用程序调用 系统调用来实现的。理解基本的系统调用机制将帮助你理解是如何向应用提供这些服务的。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">理解ECF将帮助你编写有趣的新应用程序。操作系统为应用程序提供了强大的ECF机制， 用来创建新进程、等待进程终止、通知其他进程系统中的异常事件，以及检测和晌应这些 事件。如果你理解这些ECF机制，那么你就能用它们来编写诸如Unix外壳和Web服务器 之类的有趣程序了。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•理解ECF将帮助你理解并发。ECF是计算机系统中实现并发的基本机制。中断应用程序、 进程和线程（它们的执行在时间上是重叠的）执行的异常处理程序和中断应用程序执行的 信号处理程序都是在运行中的并发的例子。理解ECF是理解并发的第一步。我们会在第 12章中更详细地研究并发。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•理解ECF将帮助你理解软件异常如何工作。像0+和Java这样的语言通过try、catch以及 ttrow语句来提供软件异常机制。软件异常允许程序进行非本地跳转（违反通常的调用/返回 栈规则的跳转）来响应错误情况。非本地跳转是一种应用层ECF,在C中是通过set jmp 和longjmp函数提供的。理解这些低级函数将帮助你理解高级软件异常如何得以实现。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">对系统的学习，到目前为止你已经了解了应用是如何与硬件交互的。这一章的重要性在于你 将开始学习应用是如何与操作系统交互的。有趣的是,这些交互都是围绕着ECF的。我们将描 述存在于一个计算机系统中所有层次上的各种形式的ECF。从异常开始，异常位于硬件和操作 系统交界的部我们还会讨论系统调用，它们是为应用程序提供到操作系统的入口点的异常。 然后，我们会提升抽象的层次，描述进程和信号，它们位于应用和操作系统的交界之处。最后， 我们将讨论非本地跳转，这是ECF的一种应用层形式。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre11">
<b class="calibre13">
<span class="calibre4">8.1</span>
</b>
</span>
 <span class="calibre11">
<tt class="calibre3">
<span class="calibre4">异常</span>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">异常是异常控制流的一种形式，它一部分是由硬件实现的，一部分是由操作系统实现的。西 为它们有一部分是由硬件实现的，所以具体细节将随系统的不同而有所不同。然而，对于每个系 统而言，基本的思想都是相同的。在这一节中我们的目的是让你对异常和异常处理有一个一般性 的了解，并且向你揭示现代计算机系统的一个经常令人感到迷惑的方面。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre28">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">事件在这 里发生</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1"><img src="../images/00169.jpeg" class="calibre5"/>
</p>
<p height="0pt" width="0pt" class="calibre28">
<tt class="calibre3">
<span class="calibre4">异常的剖析。处理器状态中的变化（事件）触发 从应用程序到异常处理程序的突发的控制转移 (异常)。在异常处理程序完成处理后，它将控制 返回给被中断的程序或者终止</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">异常（exception)就是控制流中的突变，用来响应处理器状态中的某些变化。图8-1展示了 基本的思想。在图中，当处理器状态中发生一个重要的变化时，处理器正在执行某个当前指令 在处理器中，状态被编码为不同的 位和信号。状态变化称为事件（event)。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">事件可能和当前指令的执行直接相关。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">比如，发生虚拟存储器缺页、算术溢出，</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">或者一条指令试图除以零。另一方面，</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">事件也可能和当前指令的执行没有关系。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">比如，一个系统定时器产生信号或者一 个I/O请求完成。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">图</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">8-1</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在任何情况下，当处理器检测到有事 件发生时，它就会通过一</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">张叫做异常表</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">(exception table)的跳转表，进行一个间 接过程调用（异常)，到一个专门设计用 来处理这类事件的操作系统子程序（异</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">常处理程序</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（exception handler))。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">当异常处理程序完成处理后，根据引起异常的事件的类型，会发生以下三种情况中的一种：</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">处理程序将控制返回给当前指令/胃，即当事件发生时正在执行的指令。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">处理程序将控制返回给J<sub class="calibre17">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">next</span>
</tt>
</small>
</sub>
 ,即如果没有发生异常将会执行的下一条指令。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">处理程序终止被中断的程序。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">8.1.2节将讲述关于这些可能性的更多内容。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">硬件异常与软件异常</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">OH■</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">和</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">Java</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">的程序员会注意到术语</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">“</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">异常</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">”</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">也用来描述由</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">OH•</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">和</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">Java</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">以</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">catch、throw</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">和</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">try</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">语句的形式提供的应用级</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">ECF</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">。如果想完全弄清楚，我们必须区别</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">“</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">硬件</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">”</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">和</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">“</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">软件</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">”</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">异常，但是这通常是不必要的，因为从上下文中就能够</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">;f</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">艮清楚地知道是哪种含义。</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">8.11</span>
</b>
 <tt class="calibre3">
<span class="calibre4">异常处理</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">异常可能会难以理解，因为处理异常需要硬件和软件紧密合作。很容易搞混哪个部分执行哪 个任务。让我们更详细地来看看硬件和软件的分工吧。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">系统中可能的每种类型的异常都分配了一个唯一的非负整数的</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">异常号</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">（exception number</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">)。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">其中一些号码是由处理器的设计者分配的，其他号码是由操作系统内核（操作系统常驻存储器的 部分）的设计者分配的。前者的示例包括被零除、缺页、存储器访问违例、断点以及算术溢出。 后者的示例包括系统调用和来自外部I/O设备的信号。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在系统启动时（当计算机重启或者加电时)，操作系统分配和初始化一张称为</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">异常表</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">的跳转 表，使得条目</span>
</tt>
 <span class="calibre2">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">k</span>
</i>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">包含异常</span>
</tt>
 <span class="calibre2">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">k</span>
</i>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">的处理程序的地址。图8-2展示了一张异常表的格式。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1"><img src="../images/00170.jpeg" class="calibre5"/>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常处理程序0的代码</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常处理程序1的代码</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常处理程序2的代码.</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常处理程序w-1的代码</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在运行时（当系统在执行某个程序时)，处理 器检测到发生了一个事件，并且确定了相应的异 常号h随后，处理器触发异常，方法是执行间接 过程调用，通过异常表的条目&amp;转到相应的处理程 序。图8-3展示了处理器如何使用异常表来形成适 当的异常处理程序的地址。异常号是到异常表中 的索引，异常表的起始地址放在一</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">个叫做异常表 基址寄存器</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（exception table base register)的特殊 CPU寄存器里<sub class="calibre17">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">。</span>
</tt>
</small>
</sub>
</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-2异常表。异常表是一张跳转表，其中条 目灸包含异常A的处理程序代码的地址</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">异常类似于过程调用，但是有一些重要的不 同之处。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常表</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常号 (x4)</span>
</b>
</tt>
</span>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre2">
<tt class="calibre3">
<span class="calibre4">开吊衣港</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">Bt r) Tj*iSrr</span>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-3生成异常处理程序的地址。异常号是到异常表中的索引</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•过程调用时，在跳转到处理程序之前，处理器将返回地址压入栈中。然而，根据异常的类 型，返回地址要么是当前指令（当事件发生时正在执行的指令)，要么是下一条指令（如 果事件不发生，将会在当前指令后执行的指令)。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•处理器也把一些额外的处理器状态压到栈里，在处理程序返回时，重新开始被中断的程序 会需要这些状态。比如，一个IA32系统将包含当前条件码和其他内容的EFLAGS寄存器 压入栈中。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•如果控制从一个用户程序转移到内核，那么所有这些项目都被压到内核栈中，而不是压到 用户栈中。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•异常处理程序运行</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">在内核模式下</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（见8.2.4节)，这意味着它们对所有的系统资源都有完全 的访问权限。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">一旦硬件触发了异常，剩下的工作就是由异常处理程序在软件中完成。在处理程序处理完事件之 后，它通过执行一条特殊的“</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">从中断</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">返回”指令，可选地返回到被中断的程序，该指令将适当的 状态弹回到处理器的控制和数据寄存器中，如果异常中断的是一个用户程序，就将状态恢复为用</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">户模式</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（见8.2.4节)，然后将控制返回给被中断的程序。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">8.1.2</span>
</b>
 <tt class="calibre3">
<span class="calibre4">异常的类别</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">异常可以分为四类：</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">中断</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（interrupt)、</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">陷阱</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（trap)、</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">故障</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（fault)</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">和终止</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（abort)。图8-4 中的表对这些类别的属性做了小结。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">1</span>
</b>
 <tt class="calibre3">
<span class="calibre4">.中断</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">中断是异步发</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">生的，是来自处理器外部的I/O设备的信号的结果。硬件中断不是由任何一条</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">专门的指令造成的，从这个意义上来说它是异步的。硬件中断的异常处理程序通常称为中</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">断处理</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">程序(interrupt handler)。</span>
</tt>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">类别</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">原因</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异步/同步</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">返回行为</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">中断</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">来自I/o设备的信号</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异步</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">总是返回到下一条指令</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">陷阱</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">有意的异常</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">同步</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">总是返回到下一条指令</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">故障</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">潜在可恢复的错误</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">同步</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">可能返回到当前指令</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">终止</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">不可恢复的错误</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">同步</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">不会返回</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-4异常的类别。异步异常是由处理器外部的I/O设备中的事件产生的，同步异常是执行一条指令 的直接产物</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-5概述了一个中断的处理。I/O设备，例如网络适配器、磁盘控制器和定时器芯片，通 过向处理器芯片上的一个引脚发信号，并将异常号放到系统总线上，以触发中断，这个异常号标 识了引起中断的设备。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在当前指令完成执行之后，</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">图8-5</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">中断处理。中断处理程序将控制返回给应用程序控制流中 的下一条指令</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre28">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(2)在当前指令完成后， 控制传递给处理程序</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre28">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(1)在当前指令 的执行过程中，中 断引脚电压变髙了</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1"><img src="../images/00171.jpeg" class="calibre5"/>
</p>
<p height="0pt" width="0pt" class="calibre28">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(3)中断处 理程序运行</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre28">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(4)处理程序返回 到下一条指令</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">处理器注意到中断引脚的电压变 高了，就从系统总线读取异常 号，然后调用适当的中断处理程 序。当处理程序返回时，它就将 控制返回给下一条指令（即如果 没有发生中断，在控制流中会在 当前指令之后的那条指令）。结 果是程序继续执行，就好像没有 发生过中断一样。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">剩下的异常类型（陷阱、故障和终止）是同步发生的，是执行当前指令的结果。我们把这类 指令叫做故障指令（faulting instruction)。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">2.陷拼和系统调用</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">陷阱是有意的</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">异常，是执行一条指令的结果。就像中断处理程序一样，陷阱处理程序将控制 返回到下一条指令。陷阱最重要的用途是在用户程序和内核之间提供一个像过程一样的接口，叫</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">做系统调用。</span>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(1)应用程 syscall 序执行一次系 统调用</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(2)控制传递给处理程序</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">用户程序经常需要向内核请求服务，比如读一个文件（read)、创建一个新的进程 (fork)、加载一个新的程序（execve),或者终止当前进程（exit)。为了允许对这些内核服 务的受控的访问，处理器提供了一条特殊的“syscallw”指令，当用户程序想要请求服务《 时，可以执行这条指令。执行syscall指令会导致一个到异常处理程序的陷阱，这个处理程序 对参数解码，并调用适当的内核 程序。图8-6概述了一个系统调 用的处理。从程序员的角度来看，</span>
</tt>
</p>
<p height="0pt" width="-18pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-6陷阱处理。陷阱处理程序将控制返回给应用程序控制流中 的下一条指令</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(4)处理程序返回到 syscall之后的指令</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(3)陷阱处 理程序运行</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">系统调用和普通的函数调用是一 样的。然而，它们的实现是非常 不同的。普通的函数运行在用户 樸式（user mode)中，用户模式 限制了函数可以执行的指令的类 型，而且它们只能访问与调用函</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">数相同的栈。系统调用运行在内</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">核模式</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（kernel mode)中，内核模式允许系统调用执行指令，并 访问定义在内核中的栈。8.2.4节会更详细地讨论用户模式和内核模式。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<b class="calibre13">
<span class="calibre4">3</span>
</b>
 <tt class="calibre3">
<span class="calibre4">.故障</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">故障由错误情况引起,它可能能够被故障处理程序修正。当故障发生时，处理器将控制转移 给故障处理程序。如果处理程序能够修正这个错误情况，它就将控制返回到引起故障的指令，从 而重新执行它。否则，处理程序返回到内核中的abort例程，abort例程会终止引起故障的应 用程序。图8-7概述了一个故障的处理。</span>
</tt>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">⑴当前指令</span>
</b>
</tt>
</span>
 <span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">T,</span>
</b>
</i>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(2)控制传递给处理程序</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">L --- 、… <sub class="calibre24">
<small class="calibre8">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">h</span>
</i>
</tt>
</small>
</sub>
</span>
</b>
</i>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">导致一个故障</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(3)故障处 <sub class="calibre24">
<small class="calibre8">
<span class="calibre18">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">r</span>
</b>
</tt>
</span>
</small>
</sub>
 理程序运行</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td colspan="2" class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(4)处理程序要么重新</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td colspan="2" class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">^ 执行指令，要么终止</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-7故障处理。根据故障是否能够被修复，故障处理程序要么重新执行引起故障的指令，要么终止</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">一个经典的故障示例是缺页异常，当指令引用一个虚拟地址，而与该地址相对应的物理页面 不在存储器中，因此必须从磁盘中取出时，就会发生故障。就像我们将在第9章中看到的那样、 一个页面就是虚拟存储器的一个连续的块（典型的是4KB)。缺页处理程序从磁盘加载适当的页 面，然后将控制返回给引起故障的指令。当指令再次执行时，相应的物理页面已经驻留在存储器 中了，指令就可以没有故障地运行完成了。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<b class="calibre13">
<span class="calibre4">4</span>
</b>
 <tt class="calibre3">
<span class="calibre4">.终止</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">终止是不可恢复的致命错误造成的结果，通常是一些硬件错误，比如DRAM或者SRAM位 被损坏时发生的奇偶错误。终止处理程序从不将控制返回给应用程序。如图8-8所示，处理程序 将控制返回给一个abort例程，该例程会终止这个应用程序。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<span class="calibre4">(</span>
</i>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">,)</span>
</tt>
</span>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">发生致命<sub class="calibre29">
<small class="calibre8">
<span class="calibre18">
<i class="calibre15">
<span class="calibre4">1</span>
</i>
</span>
</small>
</sub>
</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">      </span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">”</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">      </span>
</tt>
</span>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">（</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">      </span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">2</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">      </span>
</tt>
</span>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">)传递控制给处理程序</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">      </span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">,</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">的硬件错误</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      <sup class="calibre23">
<small class="calibre8">
<span class="calibre18">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">CU,T</span>
</b>
</tt>
</span>
</small>
</sup>
       </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">""1</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(3)终止处</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">理程序运行</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">► abort</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<sub class="calibre17">
<small class="calibre8">
<span class="calibre18">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">t</span>
</b>
</tt>
</span>
</small>
</sub>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">      </span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(4)处理程序返回到</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">abort例程</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-8终止处理。终止处理程序将控制传递给一个内核abort例程，该例程会终止这个应用程序</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">Linux/IA32</span>
</b>
 <tt class="calibre3">
<span class="calibre4">系统中的异常</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">为了使描述更具体，让我们来看看为IA32系统定义的一些异常。有髙达256种不同的异常 类型[27]。0〜31的号码对应的是由Intel架构师定义的异常，因此对任何IA32系统都是一样的。 32〜255的号码对应的是操作系统定义的中断和陷阱。图8-9展示了一些示例。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">Linux/IA32</span>
</b>
 <tt class="calibre3">
<span class="calibre4">故障和终止</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">除法错误。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">当应用试图除以零时，或者当一个除法指令的结果对于目标操作数来说太大了 的时候，就会发生除法错误（异常0)。Unix不会试图从除法错误中恢复，而是选择中止程序。 Linux外壳通常会把除法错误报告为“浮点异常”（Floating exertion)。</span>
</tt>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常号</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">描述</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">异常类别</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">0</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">除法错误</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">故障</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">13</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">一般保护故障</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">故障</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">14</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">缺页</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">故障</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">• 18</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">机器检查</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">终止</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">32 〜127</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">操作系统定义的异常</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">中断或陷阱</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">128 (0x80)</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">系统调用</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">陷阱</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">129 〜255</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">操作系统定义的异常</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">中断或陷阱</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">图8-9 IA32系统中的异常示例</span>
</b>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">一般保护故障。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">许多原因都会导致不为人知的一般保护故障（异常13),通常是因为一个程 序引用了一个未定义的虚拟存储器区域，或者因为程序试图写一个只读的文本段。Linux不会尝 试恢复这类故障。Linux外壳通常会把这种一般保护故障报告为“段故障”（Segmentaticmfault)。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">缺页（异常14)是会重新执行产生故障的指令的一个异常示例。处理程序将磁盘上物理存 储器相应的页面映射到虚拟存储器的一个页面，然后重新开始这条产生故障的指令。我们将在第 9章中看到缺页是如何工作的细节。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">机器检查。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">机器检查（异常18)是在导致故障的指令执行中检测到致命的硬件错误时发生 的。机器检査处理程序从不返回控制给应用程序。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">Linux/IA32系统调用</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">Linux提供上百种系统减用，当应用程序想要请求内核服务时可以使用，包括读文件、写文 件或是创建一个新进程。图8-10给出了一些常见的Linux系统调用。每个系统调用都有一个唯 一的整数号，对应于一个到内核中跳转表的偏移量。</span>
</tt>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">编号</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">名字</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">描述</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">编号</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">名字</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">描述</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">1</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">exit</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">结束进程</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">27</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">alarm</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">设置传送信号的警告时钟</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">2</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">fork</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">创建新进程</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">29</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">pause</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">挂起进程直到信号到达</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">•</span>
</b>
</i>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">3</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">read</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">读文件</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">37</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">kill</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">发送信号（译者注：结束信 号）到另一个进程</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">4</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">write</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">写文件</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">48</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">signal</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">安装一个信号处理程序</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">5</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">open</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">打开文件</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">63</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">dup2</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">复制文件描述符</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">6</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">close</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">关闭文件</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">64</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">getppid</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">获得父进程ID</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">7</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">waitpid</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">等待子进程结束</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">65</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">getpgrp</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">获得进程组.</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">11</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">execve</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">加载和运行程序</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">67</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">sigaction</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.安装可移植的信号处理程序</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">19</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">lseek</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">定位到文件偏移量处</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">90</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">mmap</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">将存储器页映射到文件</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">20</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">getpid</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">获得进程ID</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">106</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">stat</span>
</b>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">获得有关文件的信息</span>
</b>
</tt>
</span>
</blockquote>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">图</span>
</b>
</tt>
 <tt class="calibre3">
<span class="calibre4">8-10 Linux/IA32</span>
</tt>
 <tt class="calibre3">
<b class="calibre13">
<span class="calibre4">系统中常用的系统调用示例。</span>
</b>
</tt>
 <tt class="calibre3">
<span class="calibre4">Linux</span>
</tt>
 <tt class="calibre3">
<b class="calibre13">
<span class="calibre4">提供上百种系统调用。来源：</span>
</b>
</tt>
 <tt class="calibre3">
<span class="calibre4">/iisr/include/sys/ syscall.h</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">在IA3.2.系统上，系统调用是通过一条称为int</span>
</tt>
 <span class="calibre2">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">n</span>
</i>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">的陷阱指令来提供的，其中《可能是IA32 异常表中256个条目中任何一个的索引。在历史上,系统调用是通过异常128 (0x80)提供的。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">C程序用syscall函数可以直接调用任何系统调用。然而，实际中几乎没必要这么做。对 于大多数系统调甩，标准C库提供了一组方便的包装函数。这些包装函数将参数打包到一起, 以适当的系统调用号陷入内核，然后将系统调用的返回状态传递回调用程序。在本书全文中，我 们將系统调用和与它们相关联的包装函数称为</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">系统级</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">函数，这两个术语可以互换地使用。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">研究程序能够如何使用int指令来直接调用Linux系统调用是很有趣的。所有的到Linux 系统调用的参数都是通过通用寄存器而不是栈传递的。按照惯例，寄存器％eax包含系统调用 号，寄存器％ebx、％ecx、％edx、％esi、%edi和％ebp包含最多六个任意的参数。栈指针％esp 不能使用，因为当进入内核模式时，内核会覆盖它。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">例如，考虑大家熟悉的hello程序的下面这个版本，是用系统级函数write来写的：</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">int main()</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">write(1, "hello, world\n<sup class="calibre23">
<small class="calibre8">
<span class="calibre18">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">M</span>
</b>
</tt>
</span>
</small>
</sup>
 , 13);</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">exit(O);</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">write函数的第一个参数将输出发送到stdout。第二个参数是要写的字节序列，而第三 个参数是要写的字节数。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-11给出的是hello程序的汇编语言版本，直接使用int指令来调用write和exit 系统调用。第9〜13行调用write函数。首先，第9行将系统调用write的编号存放在％eax 中，第10〜12行设置参数列表。然后第13行使用int指令来调用系统调用。类似地，第 14〜16行调用exit系统调用。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">code/ecf/hello-asm.sa</span>
</b>
</i>
</span>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">1</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.section .data</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">2</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">string:</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">3</span>
</tt>
</span>
</p>
</td>
<td colspan="2" class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.ascii "hello, world\n"</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">4</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">string_end</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">:</span>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">5</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.equ len, string_end</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">-</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">string</span>
</b>
</tt>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">6</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.section .text</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">7</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">.globl main</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">8</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">main:</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td colspan="2" class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">First, call w:ri te(1, "hello, world\n" , 13)</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">9</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">movl $4, %eax</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">System call number 4</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">10</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">movl $1, %ebx</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">stdout has descriptor 1</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">11</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">movl $string, %ecx</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">Hello uorld string</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">12</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">movl $len, %edx</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">String length</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">13</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">int $0x80</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">System call code</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">Mext, call exi t (0)</span>
</b>
</i>
</span>
</p>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">14</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">movl $1, %eax</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">System call number 0</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">15</span>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">movl $0, %ebx</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">Argument</span>
</b>
</i>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">is</span>
</tt>
</span>
 <span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">0</span>
</b>
</i>
</span>
</p>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">16</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">int $0x80</span>
</b>
</tt>
</span>
</p>
</td>
<td class="calibre21">
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">System call code</span>
</b>
</i>
</span>
</p>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<i class="calibre15">
<b class="calibre13">
<span class="calibre4">code/ecf/hello-asm.sa</span>
</b>
</i>
</span>
 <tt class="calibre3">
<b class="calibre13">
<span class="calibre4">图</span>
</b>
</tt>
 <tt class="calibre3">
<span class="calibre4">8-11</span>
</tt>
 <tt class="calibre3">
<b class="calibre13">
<span class="calibre4">直接用</span>
</b>
</tt>
 <tt class="calibre3">
<span class="calibre4">Linux</span>
</tt>
 <tt class="calibre3">
<b class="calibre13">
<span class="calibre4">系统调用来实现</span>
</b>
</tt>
 <tt class="calibre3">
<span class="calibre4">hello</span>
</tt>
 <tt class="calibre3">
<b class="calibre13">
<span class="calibre4">程序</span>
</b>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">关于术语的注释</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">各种异常类型的术语是根据系统的不同而有所不同的。处理器宏体系结构（macroarchitecture) 规范通常会区分异步的“中断”和同步的“异常”，但是并没有提供描述这些非常相似的概念的 概括性的术语。为了避免不断地提到“异常和中断”以及“异常或者中断”，我们用单词“异常” 作为通用的术语，而且只有在必要时才区别异步异常（中断）和同步异常（陷阱、故障和终止）。 正如我们提到过的，对于每个系统而言，基本的概念都是相同的，但是你应该意识到一些制造厂 商的手册会用“异常”仅仅表示同步事件引起的控制流的改变。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre11">
<b class="calibre13">
<span class="calibre4">8.2</span>
</b>
</span>
 <span class="calibre11">
<tt class="calibre3">
<span class="calibre4">进程</span>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">异常是允许操作系统提</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">供进程</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（process)的概念所需要的基本构造块，进程是计算机科学中 最深刻最成功的概念之一。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">当我们在一个现代系统上运行一个程序时，会得到一个假象，就好像我们的程序是系统中当 前运行着的唯一的程序。我们的程序好像是独占地使用处理器和存储器。处理器就好像是无间断 地一条接一条地执行程序中的指令。最后，我们程序中的代码和数据好像是系统存储器中唯一的 对象。这些假象都是通过进程的概念提供给我们的。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">进程的经典定义就是一个</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">执行中的程序的实例</span>
</tt>
</span>
 <span class="calibre2">
<tt class="calibre3">
<span class="calibre4">。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">系统中的每个程序都是运行在某个进程的上 下文（context)中的。上下文是由程序正确运行所需的状态组成的。这个状态包括存放在存储器 中的程序的代码和数据，它的栈、通用目的寄存器的内容、程序计数器、环境变量以及打开文件 描述符的集合。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">每次用户通过向外壳输入一个可执行目标文件的名字，并运行一个程序时，外壳就会创建一 个新的进程，然后在这个新进程的上下文中运行这个可执行目标文件。应用程序也能够创建新进 程，且在这个新进程的上下文中运行它们自己的代码或其他应用程序。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">关于操作系统如何实现进程的细节的讨论超出了本书的范围。反之，我们将关注进程提供给 应用程序的关键抽象：</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•一个独立的</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">逻辑控制流，</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">它提供一个假象，好像我们的程序独占地使用处理器。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">•一个私有的地址空间，它提供一个假象，好像我们的程序独占地使用存储器系统。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">让我们更深入地看看这些抽象。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">8.2.1</span>
</b>
 <tt class="calibre3">
<span class="calibre4">逻辑控制流</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">即使在系统中通常有许多其他程序在运行，进程也可以向每个程序提供一种假象，好像它在 独占地使用处理器。如果想用调试器单步执行程序，我们会看到一系列的程序计数器（PC)的 值，这些值唯一地对应于包含在程序的可执行目标文件中的指令，或者是包含在运行时动态链接 到程序的共享对象中的指令。这个PC值的序列叫做</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">逻辑控制流，</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">或者简称逻</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">辑流。</span>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">考虑一个运行着三个进程的系统，如图8-12所示。处理器的一个物理控制流分成了三个逻 辑流，每个进程一个。每个竖直的条表示一个进程的逻辑流的一部分。在这个例子中，三个逻辑 流的执行是交错的。进程A运行了一会儿，然后是进程B开始运行到完成。然后，进程C运行 了一会儿，进程A接着运行直到完成。最后，进程C可以运行到结束了。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">图8-12的关键点在于进程是轮流使用处</span>
</tt>
 <tt class="calibre3">
<span class="calibre4">      </span>
</tt>
 <tt class="calibre3">
<span class="calibre4">、_<sub class="calibre17">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">a</span>
</tt>
</small>
</sub>
</span>
</tt>
 <tt class="calibre3">
<span class="calibre4">      </span>
</tt>
 <tt class="calibre3">
<span class="calibre4">、_</span>
</tt>
 <tt class="calibre3">
<span class="calibre4">      </span>
</tt>
 <tt class="calibre3">
<span class="calibre4">、_</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">理器的。每个进程执行它的流的一部分，然</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">后</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">被抢占</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（preempted)(暂时挂起），然后轮 到其他进程。对于一个运行在这些进程之一 的上下文中的程序，它看上去就像是在独占时间 地使用处理無。唯一的反面例证是，如果我 们精确地测量每条指令使用的时间，会发现 在程序中一些指令的执行之间，CPU好像会 周期性地停顿。然而，每次处理器停顿，它图8-12逻辑控制流。进程为每个程序提供了一种假 随后继续执行我们的程序，并不改变程序存</span>
</tt>
 <tt class="calibre3">
<span class="calibre4">      </span>
</tt>
 <tt class="calibre3">
<span class="calibre4">象，好像程序在独占地使用处理器。每个竖</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">储器位置或寄存器的内容。</span>
</tt>
 <tt class="calibre3">
<span class="calibre4">      </span>
</tt>
 <tt class="calibre3">
<span class="calibre4">直的条表示一个进程的逻辑控制流的一部分</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">8-2.2</span>
</b>
 <tt class="calibre3">
<span class="calibre4">并发流</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">计算机系统中逻辑流有许多不同的形式。异常处理程序、进程、信号处理程序、线程和Java 进程都是逻辑流的例子。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">一个</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">逻辑流的执行在时间上与另一个流重叠，称为</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">并发流</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（concurrentflow),这两个流被称</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">为并发地运行</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">。更准确地说，流X和Y互相并发，当且仅当X在Y开始之后和Y结束之前开始, 或者Y在X开始之后和X结束之前开始。例如，在图8-12中，进程A和B并发地运行，A和C 也一样。另一方面，B和C没有并发地运行,因为B的最后一条指令在C的第一条指令之前执行。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">多个流并发地执行的一般现象称</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">为并发（</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">concurrency</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">)。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">一个进程和其他进程轮流运行的</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">概</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">念称为</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">多任务（</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">multitasking</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">)。一个</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">进程执行它的控制流的一部分的每一时间段叫做</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">时间片</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">(time slice</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">)。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">因此，多住务也叫做时</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">间分片</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">（time slicing</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">)。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">例如，在图</span>
</tt>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">8-12</span>
</b>
</span>
 <tt class="calibre3">
<span class="calibre4">中，进程</span>
</tt>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">A</span>
</b>
</span>
 <tt class="calibre3">
<span class="calibre4">的流由 两个时间片组成。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">注意，并发的思想与流运行的处理器核数或者计算机数无关。如果两个流在时间上重叠，那 么它们就是并发的，即使它们是运行在同一个处理器上的。然而，有时我们会发现确认并行流是 很有帮助的，它是并发流的一个真子集。如果两个流并发地运行在不同的处理器核或者计算机 上，那么我们称</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">它们为并行流</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">（parallel flow),</span>
</b>
</span>
 <tt class="calibre3">
<span class="calibre4">它</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">们并行地运行</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">（running in parallel),</span>
</b>
</span>
 <tt class="calibre3">
<span class="calibre4">且</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">并行地 执行</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">（parallel execution</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">)。</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">®练习题8.1考虑三个具有下述起始和结束时间的进程：</span>
</tt>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">进程</span>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">起始时间</span>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">结束时间</span>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">A</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">0</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">2</span>
</b>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">B</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">1</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">4</span>
</b>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">C</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">3</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">5 .</span>
</b>
</span>
</blockquote>
</td>
</tr>
</table>
<p class="calibre9" style="margin:0pt; border:0pt; height:1em"> </p>
<p class="calibre9" style="margin:0pt; border:0pt; height:1em"> </p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">对于每对进程，指出它们是否是并发地运行的：</span>
</tt>
</p>
<table valign="top" class="calibre19">
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">进程对</span>
</tt>
</span>
</blockquote>
</td>
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">并发的？</span>
</tt>
</span>
</blockquote>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">AB</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">AC</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
<tr valign="top" class="calibre20">
<td class="calibre21">
<blockquote height="0pt" width="0pt" class="calibre22">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">BC</span>
</b>
</span>
</blockquote>
</td>
<td class="calibre21"><br class="calibre9"/>
<br class="calibre9"/>
</td>
</tr>
</table>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">私有地址空间</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">进程也为每个程序提供一种假象，好像它独占地使用系统地址空间。在一台有《位地址的机 器上，</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">地址空间是</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">2"个可能地址的集合，0, 1,…，2"-1。一个进程为每个程序提供它自己的</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">私有地址空间。</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">一般而言，和这个空间中某个地址相关联的那个存储器字节是不能被其他进程读 或者写的，从这个意义上说，这个地址空间是私有的。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">尽管和每个私有地址空间相关联的存储器的内容一般是不同的，但是每个这样的空间都有相 同的通用结构。比如，图8-13展示了一个x86 Linux进程的地址空间的组织结构。地址空间底部 是保留给用户程序的，包括通常的文本、数据、堆和栈段。对于32位进程来说，代码段从地址 0x08048000开始，对于64位进程来说，代码段从地址0x00400000开始。地址空间顶部是 保留给内核的。地址空间的这个部分包含内核在代表进程执行指令时（比如，当应用程序执行一 个系统调用时）使用的代码、数据和栈。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<tt class="calibre3">
<span class="calibre4">用户模式和内核模式</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">为了使操作系统内核纖一个无懈可击的进程抽象，处理器必须提供一种机制，限制一个应 用可以执行的指令以及它可以访问的地址空间范围。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">处理器通常是用某个控制寄存器中的一个</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">模式位</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（modeWt)来提供这种功能的,该寄存器 描述了进程当前享有的特权。当设置了模式位时，进程就运行</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">在内核模式中</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（有时</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">叫做超级用户</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">模式)。一个运行在内核模式的进程可以执行指令集中的任何指令，并且可以访间系统中任何存 储器位置<sub class="calibre17">
<small class="calibre8">
<tt class="calibre3">
<span class="calibre4">。</span>
</tt>
</small>
</sub>
</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">内核虚拟存储器</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">(</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">代码、数据、堆、栈）</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">用户代码不可见 的存储器</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">-%esp (</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">栈指针）</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">用户栈</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">(</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">运行时创建的）</span>
</tt>
</span>
</p>
<p class="calibre9" style="margin:0pt; border:0pt; height:1em"> </p>
<p class="calibre9" style="margin:0pt; border:0pt; height:1em"> </p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">共拿库的存储器映射区域<sup class="calibre23">
<small class="calibre8">
<span class="calibre18">
<b class="calibre13">
<span class="calibre4">!</span>
</b>
</span>
</small>
</sup>
</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">-brk</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">运行时堆</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">，•</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">(</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">
<span class="calibre14">用</span>
</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">
<span class="calibre14">halloc</span>
</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">
<span class="calibre14">仓</span>
</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">
<span class="calibre14">||</span>
</span>
</b>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">
<span class="calibre14">率的</span>
</span>
</tt>
</span>
 <span class="calibre12">
<b class="calibre13">
<span class="calibre4">)</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">_/写&amp;</span>
</b>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">、</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(.data、.bss )</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">只读段</span>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<b class="calibre13">
<span class="calibre4">0x08048000 (32) 0x00400000 (64)</span>
</b>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">(.init、. text、.rodata)</span>
</b>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre2">
<tt class="calibre3">
<i class="calibre15">
<span class="calibre4">I</span>
</i>
</tt>
</span>
</p>
<p height="0pt" width="0pt" class="calibre1">
<span class="calibre12">
<tt class="calibre3">
<span class="calibre4">图</span>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<b class="calibre13">
<span class="calibre4">8-13</span>
</b>
</tt>
</span>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">进程地址空间</span>
</tt>
</span>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">没有设置模式位时，进程就运行在</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">用户模</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">式中。用户模式中的进程不允许执行特</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">权指令</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">(privileged instruction),比如停止处理器、改变模式位，或者发起一个I/O操作。也不允许用户 模式中的进程直接引用地址空间中内核区内的代码和数据。任何这样的尝试都会导致致命的保护 故障。反之，用户程序必须通过系统调用接口间接地访问内核代码和数据。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">运行应用程序代码的进程初始时是在用户模式中的。进程从用户模式变为内核模式的唯一方 法是通过诸如中断、故障或者陷入系统调用这样的异常。当异常发生时，控制传递到异常处理程. 序，处理器将模式从用户模式变为内核模式。处理程序运行在内核模式中，当它返回到应用程序 代码时，处理器就把模式从内核模式改回到用户模式。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">Linux提供了一种聪明的机制，叫做/proc文件系统，它允许用户模式进程访问内核数 据结构的内容。/proc文件系统将许多内核数据结构的内容输出为一个用户程序可以读的文 本文件的层次结构。比如，你可以使用/proc文件系统找出一般的系统属性，如CPU类型 (/proc/cpuinfo),或者某个特殊的进程使用的存储器段（/proc/〈process id&gt;/maps)。 2.6版本的Linux内核引入/sys文件系统，它输出关于系统总线和设备的额外的低层信息。</span>
</tt>
</p>
<p height="0pt" width="0pt" class="calibre1">
<b class="calibre13">
<span class="calibre4">8.2.5</span>
</b>
 <tt class="calibre3">
<span class="calibre4">上下文切换</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">操作系统内核使用一种称</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">为上下文切换</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">（context switch)的较高层形式的异常控制流来实现 多任务。上下文切换机制是建立在8.1节中已经讨论过的那些较低层异常机制之上的。</span>
</tt>
</p>
<p height="0pt" width="2em" class="calibre1">
<tt class="calibre3">
<span class="calibre4">内核为每个进程维持一个上下文（context)。上下文就是内核重新启动一个被抢占的进程所 需的状态。它由一些对象的值组成，这些对象包括通用目的寄存器、浮点寄存器、程序计数器、 用户栈、状态寄存器、内核栈和各种内核数据结构，比如描绘地址空间的</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">页表、</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">包含有关当前进 程信息的进</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">程表，</span>
</tt>
</span>
 <tt class="calibre3">
<span class="calibre4">以及包含进程已打开文件的信息的文</span>
</tt>
 <span class="calibre12">
<tt class="calibre3">
<span class="calibre4">件表。</span>
</tt>
</span>
</p>
</body>
</html>
